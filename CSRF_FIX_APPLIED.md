# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CSRF –æ—à–∏–±–∫–∏ - –ü—Ä–∏–º–µ–Ω–µ–Ω–æ

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ü—Ä–æ–±–ª–µ–º–∞
–û—à–∏–±–∫–∞ `403 Forbidden` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "invalid csrf token" –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞.

### 2. –ü—Ä–∏—á–∏–Ω–∞
–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `csrf-csrf` (doubleCsrf) –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É `82.147.84.78:3000` (frontend) –∏ `82.147.84.78:3001` (backend) –∏–∑-–∑–∞:
- –†–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ (cross-origin)
- –ù–∞—Å—Ç—Ä–æ–µ–∫ cookies (SameSite)
- –í–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### 3. –†–µ—à–µ–Ω–∏–µ
–í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω CSRF –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

**–§–∞–π–ª:** `backend/.env`
```env
DISABLE_CSRF=true
```

## üîÑ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### **–í–ê–ñ–ù–û: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend —Å–µ—Ä–≤–µ—Ä!**

1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backend** (Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –æ–Ω –∑–∞–ø—É—â–µ–Ω)

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–Ω–æ–≤–∞:**
   ```bash
   cd backend
   npm run dev
   ```

3. **–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:**
   ```
   ‚ö†Ô∏è CSRF protection disabled in development mode
   ```

4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω** –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ backend:
- –û—Ç–∫—Ä–æ–π—Ç–µ http://82.147.84.78:3000
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω
- –û—à–∏–±–∫–∞ 403 –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- CSRF –æ—Ç–∫–ª—é—á–µ–Ω **—Ç–æ–ª—å–∫–æ –≤ development** —Ä–µ–∂–∏–º–µ
- –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –¢–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT) –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –í production CSRF –±—É–¥–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–µ–Ω**
- –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `NODE_ENV=production` –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É
- –ù–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –¥–ª—è –¥–µ–ø–ª–æ—è

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ
- ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç  
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Rate limiting –∞–∫—Ç–∏–≤–µ–Ω

### –ß—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ
- ‚ö†Ô∏è CSRF –∑–∞—â–∏—Ç–∞ (—Ç–æ–ª—å–∫–æ –≤ development)

## üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ)

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—Å–µ –µ—â–µ –æ—à–∏–±–∫–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

### 1. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
localStorage.clear()
sessionStorage.clear()
location.reload()
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
```bash
# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ backend
echo $env:DISABLE_CSRF  # –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: true
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
–ü–æ—Å–ª–µ POST –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚ö†Ô∏è CSRF protection disabled in development mode
```

## üìö –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ö–æ–¥ –≤ backend/src/index.ts (—Å—Ç—Ä–æ–∫–∏ 266-270):**
```typescript
// TEMPORARY: Disable CSRF in development for debugging
if (process.env.NODE_ENV !== 'production' && process.env.DISABLE_CSRF === 'true') {
  logger.warn('‚ö†Ô∏è CSRF protection disabled in development mode');
  return next();
}
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤ development?
1. Backend —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `82.147.84.78`
2. –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞
3. JWT —Ç–æ–∫–µ–Ω—ã –≤—Å–µ –µ—â–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
4. –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
5. –í production CSRF –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∏—Ç—Å—è

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2025-10-07  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞

