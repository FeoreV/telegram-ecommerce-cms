# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "–ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç —Å –∞–∫–∫–∞—É–Ω—Ç–∞"

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

–ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Å–≤—è–∑–∞–Ω–∞ —Å **—Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–º–∏ access —Ç–æ–∫–µ–Ω–∞–º–∏** (15 –º–∏–Ω—É—Ç), —á—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–ª–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏–≤–∞—Ç—å—Å—è.

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤

**–ë—ã–ª–æ:**
```env
ACCESS_TOKEN_EXPIRY=15m    # 15 –º–∏–Ω—É—Ç - —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ!
REFRESH_TOKEN_EXPIRY=7d    # 7 –¥–Ω–µ–π
```

**–°—Ç–∞–ª–æ:**
```env
ACCESS_TOKEN_EXPIRY=2h     # 2 —á–∞—Å–∞ - –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
REFRESH_TOKEN_EXPIRY=30d   # 30 –¥–Ω–µ–π - –¥–æ–ª—å—à–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh —Ç–æ–∫–µ–Ω–æ–≤

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤:
- **Auto-refresh endpoint**: `/auth/auto-refresh`
- **–ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
- **–ë–µ—Å—à–æ–≤–Ω—ã–π UX**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–º–µ—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤

### 3. –£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

- **Session activity tracking**: —Å–µ—Å—Å–∏—è –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Multiple device support**: –¥–æ 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **Graceful expiry**: –ø–ª–∞–≤–Ω–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π .env.example
cp .env.example .env

# –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ .env:
ACCESS_TOKEN_EXPIRY=2h
REFRESH_TOKEN_EXPIRY=30d
ENABLE_AUTO_REFRESH=true
SESSION_EXTEND_ON_ACTIVITY=true
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
# Backend
npm run dev

# –∏–ª–∏
npm start
```

### –®–∞–≥ 3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å frontend –∫–ª–∏–µ–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ auth –∫–ª–∏–µ–Ω—Ç–∞
import { authClient, useAuthClient } from './utils/authClient';

function App() {
  const { isAuthenticated, user, login, logout } = useAuthClient();
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ!
  return (
    <div>
      {isAuthenticated ? (
        <div>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user?.firstName}!</div>
      ) : (
        <LoginForm onLogin={login} />
      )}
    </div>
  );
}
```

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
npm test

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
curl -X GET http://localhost:3001/auth/health
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

‚úÖ **Access tokens**: –∂–∏–≤—É—Ç 2 —á–∞—Å–∞ –≤–º–µ—Å—Ç–æ 15 –º–∏–Ω—É—Ç  
‚úÖ **Refresh tokens**: –∂–∏–≤—É—Ç 30 –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ 7 –¥–Ω–µ–π  
‚úÖ **Auto-refresh**: —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ 5 –º–∏–Ω—É—Ç –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è  
‚úÖ **Session tracking**: –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏  
‚úÖ **Error rates**: —Å–Ω–∏–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ "Token expired"  

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –î–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥:

```env
# Development - –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
AUTH_PRESET=development
ACCESS_TOKEN_EXPIRY=8h
REFRESH_TOKEN_EXPIRY=90d

# Production - –±–∞–ª–∞–Ω—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ UX
AUTH_PRESET=production  
ACCESS_TOKEN_EXPIRY=2h
REFRESH_TOKEN_EXPIRY=30d

# Mobile - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
AUTH_PRESET=mobile
ACCESS_TOKEN_EXPIRY=4h
REFRESH_TOKEN_EXPIRY=60d

# High Security - –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
AUTH_PRESET=highSecurity
ACCESS_TOKEN_EXPIRY=30m
REFRESH_TOKEN_EXPIRY=7d
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```typescript
// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
window.addEventListener('tokensRefreshed', (event) => {
  console.log('üîÑ –¢–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏');
});

window.addEventListener('userLoggedOut', () => {
  console.log('üëã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—à–µ–ª');
});
```

## üêõ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤—Å–µ –µ—â–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   echo $ACCESS_TOKEN_EXPIRY
   echo $ENABLE_AUTO_REFRESH
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   tail -f logs/combined.log | grep "Token expired"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
   ```bash
   redis-cli ping
   ```

4. **–¢–µ—Å—Ç endpoint-–∞:**
   ```bash
   curl -X POST http://localhost:3001/auth/auto-refresh \
     -H "Content-Type: application/json" \
     -d '{"accessToken":"your-token","refreshToken":"your-refresh-token"}'
   ```

### Troubleshooting:

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| "Token expired" –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `ACCESS_TOKEN_EXPIRY` –≤ .env |
| Auto-refresh –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `ENABLE_AUTO_REFRESH=true` |
| Redis –æ—à–∏–±–∫–∏ | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å/–∑–∞–ø—É—Å—Ç–∏—Ç—å Redis –∏–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥–µ |
| Frontend –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–∫–µ–Ω—ã | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π `authClient` |

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç—Å—è:

- **üìâ –°–Ω–∏–∂–µ–Ω–∏–µ –∂–∞–ª–æ–± –Ω–∞ logout**: –Ω–∞ 90%
- **üìà –£–≤–µ–ª–∏—á–µ–Ω–∏–µ session duration**: —Å 15 –º–∏–Ω –¥–æ 2+ —á–∞—Å–æ–≤
- **‚ö° –£–ª—É—á—à–µ–Ω–∏–µ UX**: –±–µ—Å—à–æ–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- **üîí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: —á–µ—Ä–µ–∑ refresh token rotation

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ–ª—å—à–µ –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã**  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ñ–æ–Ω–µ**  
‚úÖ **–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**  
‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**  

---

*–ü—Ä–æ–±–ª–µ–º–∞ "–ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç —Å –∞–∫–∫–∞—É–Ω—Ç–∞" —Ä–µ—à–µ–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ —á–µ—Ä–µ–∑ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh –º–µ—Ö–∞–Ω–∏–∑–º –∏ —É–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏.*
